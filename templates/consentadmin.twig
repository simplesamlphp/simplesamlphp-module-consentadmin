{% set pagetitle = 'Consent administration'|trans %}
{% extends "base.twig" %}

{% block preload %}
<link rel="stylesheet" href="{{ asset('css/consentAdmin.css', 'consentAdmin') }}">
{% endblock %}

{% block postload %}
<script src="{{ asset('js/consentAdmin.js', 'consentAdmin') }}"></script>
{% endblock %}

{% block content %}

<h2>{{ 'Consent administration'|trans }}</h2>
<p>{{ 'Here you can view and edit your consent for the Service Providers.'|trans }}</p>

<table>
    <tr>
        <th colspan="2" width="80%">{{ 'Service Provider'|trans }}</th>
        <th width="140">{{ 'Consent status'|trans }}</th>
    </tr>

{% for spName, spValues in spList %}

    {% if loop.index0 % 2 == 0 %}
        {% set rowClass = 'row0' %}
    {% else %}
        {% set rowClass = 'row1' %}
    {% endif %}

    <tr class="{{ rowClass }}">
        <td>
            <span class='caSPName'>
                <span title='{{ spValues.description|escape('html') }}'>
                {% if spValues.serviceurl is defined %}
                    {{ spValues.name|escape('html') }}
                {% else %}
                    <a class="serviceUrl" href="{{ spValues.serviceurl }}">{{ spValues.name|escape('html') }}</a>
                {% endif %}
                </span>
                <span class="show_hide" id="show_hide_{{ loop.index0 }}">
                    <span id="showing_{{ loop.index0 }}">{{ 'Show'|trans }}</span>
                    <span id="hiding_{{ loop.index0 }}">{{ 'Hide'|trans }}</span>
                    {{ 'attributes'|trans }}
                </span>
            </span>
        </td>
        <td class="caAttributes">
            <div id="attributes_{{ loop.index0 }}">
            {% if showDescription %}
                <p>{{ 'The purpose of the service is'|trans }}{{ spValues.description|escape('html') }}</p>
            {% endif %}
                <ul>
                {% for attrName, attrValue in spValues.attributes_by_sp %}
                {% if attrValue|length > 1 %}
                    <li>{{ attrName|escape('html') }}:
                        <ul>
                        {% for valKey, value in attrValue %}
                            <li>{{ value|escape('html') }}</li>
                        {% endfor %}
                        </ul>
                    </li>
                {% else %}
                    <li>{{ attrName|escape('html') }}: {{ attrValue|first|escape('html') }}</li>
                {% endif %}
                {% endfor %}
                </ul>
            </div>
        </td>
        <td class="caAllowed">
            <input class="checkbox" id="checkbox_{{ loop.index0 }}" value='{{ spValues.consentValue }}' type='checkbox'{% if spValues.consentStatus == 'ok'%} checked="checked"{% endif %} />
            <span id="consentText_{{ loop.index0 }}">{% if spValues.consentStatus == 'changed' %}{{ 'Attributes have changed'|trans }}{% endif %}</span>
        </td>
    </tr>
{% endfor %}
</table>

<p>{{ '{consentAdmin:consentadmin:consentadmin_description2}'|trans|raw }}</p>

<h2>{{ 'Logout'|trans }}</h2>
<p><a href="/{{ baseurlpath }}module.php/consentAdmin/consentAdmin.php?logout=1">{{ 'Logout'|trans }}</a></p>

{% endblock %}
